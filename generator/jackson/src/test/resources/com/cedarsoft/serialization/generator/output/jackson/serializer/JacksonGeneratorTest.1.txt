-----------------------------------com.cedarsoft.serialization.generator.test.FooSerializer.java-----------------------------------

package com.cedarsoft.serialization.generator.test;

import java.io.IOException;
import java.util.List;
import com.cedarsoft.Version;
import com.cedarsoft.VersionException;
import com.cedarsoft.VersionRange;
import com.cedarsoft.serialization.jackson.AbstractJacksonSerializer;
import org.codehaus.jackson.JsonGenerator;
import org.codehaus.jackson.JsonParser;
import org.codehaus.jackson.JsonProcessingException;
import org.jetbrains.annotations.NonNls;
import org.jetbrains.annotations.NotNull;

public class FooSerializer
    extends AbstractJacksonSerializer<Foo>
{

    @NotNull
    @NonNls
    public final static String PROPERTY_WIDTH = "width";
    @NotNull
    @NonNls
    public final static String PROPERTY_HEIGHT = "height";
    @NotNull
    @NonNls
    public final static String PROPERTY_DESCRIPTION = "description";
    @NotNull
    @NonNls
    public final static String PROPERTY_ANINT = "anInt";
    @NotNull
    @NonNls
    public final static String PROPERTY_FLOATFIELD = "floatField";
    @NotNull
    @NonNls
    public final static String PROPERTY_BARS = "bars";
    @NotNull
    @NonNls
    public final static String PROPERTY_BAR = "bar";

    public FooSerializer(BarSerializer barSerializer) {
        super("http://cedarsoft.com/serialization/generator/test/foo", VersionRange.from(1, 0, 0).to(1, 0, 0));
        add(barSerializer).responsibleFor(Bar.class).map(1, 0, 0).toDelegateVersion(1, 0, 0);
        assert getDelegatesMappings().verify();
    }

    @Override
    public void serialize(
        @NotNull
        JsonGenerator serializeTo,
        @NotNull
        Foo object,
        @NotNull
        Version formatVersion)
        throws IOException, JsonProcessingException
    {
        verifyVersionReadable(formatVersion);
        //width
        serializeTo.writeNumberField(PROPERTY_WIDTH, object.getWidth());
        //height
        serializeTo.writeNumberField(PROPERTY_HEIGHT, object.getHeight());
        //description
        serializeTo.writeStringField(PROPERTY_DESCRIPTION, object.getDescription());
        //anInt
        serializeTo.writeNumberField(PROPERTY_ANINT, object.getAnInt());
        //floatField
        serializeTo.writeNumberField(PROPERTY_FLOATFIELD, object.getFloatField());
        //bars
        serializeArray(object.getBars(), Bar.class, PROPERTY_BARS, serializeTo, formatVersion);
        //bar
        serialize(object.getBar(), Bar.class, PROPERTY_BAR, serializeTo, formatVersion);
    }

    @Override
    @NotNull
    public Foo deserialize(
        @NotNull
        JsonParser deserializeFrom,
        @NotNull
        Version formatVersion)
        throws VersionException, IOException, JsonProcessingException
    {
        //width
        nextFieldValue(deserializeFrom, PROPERTY_WIDTH);
        double width = deserializeFrom.getDoubleValue();
        //height
        nextFieldValue(deserializeFrom, PROPERTY_HEIGHT);
        int height = deserializeFrom.getIntValue();
        //description
        nextFieldValue(deserializeFrom, PROPERTY_DESCRIPTION);
        String description = deserializeFrom.getText();
        //anInt
        nextFieldValue(deserializeFrom, PROPERTY_ANINT);
        Integer anInt = deserializeFrom.getIntValue();
        //floatField
        nextFieldValue(deserializeFrom, PROPERTY_FLOATFIELD);
        float floatField = deserializeFrom.getFloatValue();
        //bars
        List<? extends Bar> bars = deserializeArray(Bar.class, PROPERTY_BARS, deserializeFrom, formatVersion);
        //bar
        Bar bar = deserialize(Bar.class, PROPERTY_BAR, formatVersion, deserializeFrom);
        //Finally closing element
        closeObject(deserializeFrom);
        //Constructing the deserialized object
        Foo object = new Foo(description, width, height, anInt, bars);
        object.setFloatField(floatField);
        object.setBar(bar);
        return object;
    }

}